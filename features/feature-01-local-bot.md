# Пункт 1: Локальный бот с базовыми командами

План: [feature-plan.md](feature-plan.md)

**Статус:** ✅ Реализовано  
**Коммиты:** `c3b6ef0` (реализация), `125b9b4` (document-фото)

## Цель

Создать простой Telegram-бот с командами `/start` и обработкой фото, который возвращает то же фото обратно пользователю.

## Задачи

1. **Настройка окружения**

   - Создать `requirements.txt` с зависимостями: `python-telegram-bot`, `requests`, `python-dotenv`
   - Создать `.env` файл для хранения `TG_BOT_TOKEN`
   - Настроить `.gitignore` для исключения `.env` и временных файлов

2. **Реализация базового бота** (файл `bot_local.py` или обновить `main.py`)

   - Команда `/start`: приветственное сообщение с инструкциями
   - Обработчик фото (MessageHandler с filters.PHOTO):
     - Скачивание фото через `get_file()`
     - Немедленная отправка того же фото обратно через `send_photo()`
   - Базовая обработка ошибок и логирование

3. **Тестирование**

   - Запуск бота локально через polling
   - Проверка команды `/start`
   - Проверка отправки фото и получения того же фото обратно

## Файлы

- `bot_local.py` (или обновить `main.py`)
- `requirements.txt`
- `.env` (шаблон `.env.example`)

## Найденные баги и доработки

### ✅ Исправлено: Обработка несжатых файлов изображений

**Проблема:**  
Бот не обрабатывал изображения, отправленные как несжатый файл (document). Обрабатывались только сжатые фото через `filters.PHOTO`.

**Решение:**  
Добавлен обработчик `handle_document_photo()` для документов-изображений:
- Проверка MIME type (`image/jpeg`, `image/png`, `image/gif`, `image/webp`, `image/bmp`)
- Проверка расширения файла (`.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`, `.bmp`)
- Использование `MessageHandler(filters.Document.ALL, handle_document_photo)`

**Применено в:** ✅ `bot_local.py` (Пункт 1)

**Требуется применить в:**
- ⏳ `main.py` (Пункт 2) — добавить обработку document-изображений в FastAPI webhook-обработчике
- ⏳ `handler.py` (Пункт 3–4) — обеспечить поддержку document-изображений в S3 и Replicate обработке
